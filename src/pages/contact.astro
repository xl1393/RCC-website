---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/sections/Footer.astro';
import Header from '../components/sections/Header.astro';
import { SITE_TITLE } from '../consts';

const pageTitle = 'Request Intake Form';
const pageDescription = 'Submit your research or collaboration interest intake form to the NYC-MEHSJ Research Capacity Core team';
---
<!doctype html>
<html lang="en" data-theme="light">
	<head>
		<BaseHead title={`${pageTitle} | ${SITE_TITLE}`} description={pageDescription} />
	</head>
	<body>
		<Header />
		<main class="max-w-3xl mx-auto px-4 py-12 md:py-20">
			<div class="text-center mb-12">
				<h1 class="text-4xl md:text-5xl font-bold text-foreground mb-4">
					Request Intake Form
				</h1>
				<p class="text-lg text-[color:var(--color-text-muted)] max-w-2xl mx-auto">
					Submit your research or collaboration interest. Our team will review your request and get back to you within 2-3 business days.
				</p>
			</div>

			<!-- Success Message (hidden by default) -->
			<div id="success-message" class="hidden mb-8 p-6 rounded-lg bg-[color:var(--color-success)] bg-opacity-10 border border-[color:var(--color-success)]">
				<div class="flex items-start gap-3">
					<svg class="w-6 h-6 text-[color:var(--color-success)] flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
					<div>
						<h3 class="font-semibold text-[color:var(--color-success)] mb-1">Intake form submitted successfully!</h3>
						<p class="text-sm text-[color:var(--color-text-secondary)]">Thank you for your interest. Our team will review your request and contact you within 2-3 business days.</p>
					</div>
				</div>
			</div>

			<!-- Error Message (hidden by default) -->
			<div id="error-message" class="hidden mb-8 p-6 rounded-lg bg-[color:var(--color-error)] bg-opacity-10 border border-[color:var(--color-error)]">
				<div class="flex items-start gap-3">
					<svg class="w-6 h-6 text-[color:var(--color-error)] flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
					<div>
						<h3 class="font-semibold text-[color:var(--color-error)] mb-1">Something went wrong</h3>
						<p class="text-sm text-[color:var(--color-text-secondary)]" id="error-text">Please try again later or contact us directly.</p>
					</div>
				</div>
			</div>

			<!-- Contact Form -->
			<form id="contact-form" class="card-surface p-8 md:p-10 rounded-xl">
				<!-- Hidden Web3Forms Access Key -->
				<input type="hidden" name="access_key" value="d03fcdd9-02d4-4886-b8ef-a18646cb1f8f">

				<!-- Hidden fields for better email formatting -->
				<input type="hidden" name="subject" value="New Research Intake Form Submission - CUNY RCC">
				<input type="hidden" name="from_name" value="CUNY RCC Research Intake Form">

				<!-- Honeypot spam protection - bots will fill this, humans won't see it -->
				<input type="checkbox" name="botcheck" class="hidden" style="display: none;" tabindex="-1" autocomplete="off">

				<!-- Optional: Redirect after successful submission -->
				<input type="hidden" name="redirect" value="https://web3forms.com/success">

				<!-- Name Field -->
				<div class="mb-6">
					<label for="name" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Name <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<input
						type="text"
						id="name"
						name="name"
						required
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] placeholder-[color:var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all"
						placeholder="Your full name"
					>
				</div>

				<!-- Email Field -->
				<div class="mb-6">
					<label for="email" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Email <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<input
						type="email"
						id="email"
						name="email"
						required
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] placeholder-[color:var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all"
						placeholder="your.email@example.com"
					>
				</div>

				<!-- Role Field -->
				<div class="mb-6">
					<label for="role" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Role/Position <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<select
						id="role"
						name="role"
						required
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all"
					>
						<option value="">Select your role...</option>
						<option value="Master's Student">Master's Student</option>
						<option value="Doctoral Student">Doctoral Student</option>
						<option value="Post-doc">Post-doc</option>
						<option value="Faculty">Faculty</option>
						<option value="Research Staff">Research Staff</option>
						<option value="Other">Other</option>
					</select>
				</div>

				<!-- Institution Field -->
				<div class="mb-6">
					<label for="institution" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Institution/Department <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<input
						type="text"
						id="institution"
						name="institution"
						required
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] placeholder-[color:var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all"
						placeholder="e.g., CUNY - City College of New York, Biology Department"
					>
				</div>

				<!-- Research Area Field -->
				<div class="mb-6">
					<label for="research_area" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Research Area/Topic <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<input
						type="text"
						id="research_area"
						name="research_area"
						required
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] placeholder-[color:var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all"
						placeholder="e.g., Health Disparities, Genomics, Community Health, etc."
					>
				</div>

				<!-- Type of Support Needed -->
				<div class="mb-6">
					<label class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-3">
						Type of Support Needed <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<div class="space-y-3 p-4 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)]">
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Research Technology Marketplace"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Research Technology Marketplace</span>
						</label>
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Principles and Practice Workshops"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Principles and Practice Workshops</span>
						</label>
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Research Strategy and Experimental Design"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Research Strategy and Experimental Design</span>
						</label>
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Bioinformatics and Analytics Support"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Bioinformatics and Analytics Support</span>
						</label>
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Artificial Intelligence for Research and Health"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Artificial Intelligence for Research and Health</span>
						</label>
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Community Participation in Research"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Community Participation in Research and Clinical Trials</span>
						</label>
						<label class="flex items-start gap-3 cursor-pointer hover:bg-[color:var(--color-bg-tertiary)] p-2 rounded transition-colors">
							<input
								type="checkbox"
								name="support_type"
								value="Center Membership Information"
								class="mt-0.5 w-5 h-5 rounded border-2 border-[color:var(--color-text-muted)] accent-[color:var(--accent)] cursor-pointer"
								style="flex-shrink: 0;"
							>
							<span class="text-sm text-[color:var(--color-text-primary)] flex-1">Center Membership â€“ Benefits, Responsibilities, and Process</span>
						</label>
					</div>
				</div>

				<!-- Project Timeline -->
				<div class="mb-6">
					<label for="timeline" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Project Timeline
					</label>
					<select
						id="timeline"
						name="timeline"
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all"
					>
						<option value="">Select timeline...</option>
						<option value="Immediate (within 1 month)">Immediate (within 1 month)</option>
						<option value="Short-term (1-3 months)">Short-term (1-3 months)</option>
						<option value="Medium-term (3-6 months)">Medium-term (3-6 months)</option>
						<option value="Long-term (6+ months)">Long-term (6+ months)</option>
						<option value="Ongoing">Ongoing</option>
						<option value="Not sure yet">Not sure yet</option>
					</select>
				</div>

				<!-- Project Description Field -->
				<div class="mb-8">
					<label for="message" class="block text-sm font-medium text-[color:var(--color-text-primary)] mb-2">
						Project Description / Research Goals <span class="text-[color:var(--color-error)]">*</span>
					</label>
					<textarea
						id="message"
						name="message"
						required
						rows="6"
						class="w-full px-4 py-3 rounded-lg bg-[color:var(--color-bg-secondary)] border border-[color:var(--color-border)] text-[color:var(--color-text-primary)] placeholder-[color:var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-transparent transition-all resize-y"
						placeholder="Please describe your research project, goals, specific challenges you're facing, and how the RCC can support your work..."
					></textarea>
				</div>

				<!-- Submit Button -->
				<div>
					<button
						type="submit"
						id="submit-btn"
						class="w-full px-6 py-4 bg-[color:var(--accent)] text-white font-semibold rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:ring-offset-2 focus:ring-offset-[color:var(--color-bg-primary)] transition-all disabled:opacity-50 disabled:cursor-not-allowed"
					>
						<span id="btn-text">Submit Request</span>
						<span id="btn-loading" class="hidden">Submitting...</span>
					</button>
				</div>
			</form>

			<!-- Contact Info -->
			<div class="mt-12 text-center text-[color:var(--color-text-muted)]">
				<p class="text-sm">
					You can also reach us directly at <a href="mailto:contact@example.com" class="text-[color:var(--accent)] hover:underline">contact@example.com</a>
				</p>
			</div>
		</main>
		<Footer />

		<!-- Form Handling Script -->
		<script>
			const form = document.getElementById('contact-form') as HTMLFormElement;
			const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
			const btnText = document.getElementById('btn-text') as HTMLSpanElement;
			const btnLoading = document.getElementById('btn-loading') as HTMLSpanElement;
			const successMessage = document.getElementById('success-message') as HTMLDivElement;
			const errorMessage = document.getElementById('error-message') as HTMLDivElement;
			const errorText = document.getElementById('error-text') as HTMLParagraphElement;

			form.addEventListener('submit', async (e) => {
				e.preventDefault();

				// Validate at least one checkbox is selected
				const checkboxes = form.querySelectorAll('input[name="support_type"]:checked');
				if (checkboxes.length === 0) {
					errorText.textContent = 'Please select at least one type of support needed.';
					errorMessage.classList.remove('hidden');
					errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
					return;
				}

				// Show loading state
				submitBtn.disabled = true;
				btnText.classList.add('hidden');
				btnLoading.classList.remove('hidden');

				// Hide previous messages
				successMessage.classList.add('hidden');
				errorMessage.classList.add('hidden');

				try {
					const formData = new FormData(form);
					const response = await fetch('https://api.web3forms.com/submit', {
						method: 'POST',
						body: formData
					});

					const data = await response.json();

					if (data.success) {
						// Show success message
						successMessage.classList.remove('hidden');
						form.reset();

						// Scroll to success message
						successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
					} else {
						// Show error message
						errorText.textContent = data.message || 'Please try again later or contact us directly.';
						errorMessage.classList.remove('hidden');
						errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
					}
				} catch (error) {
					// Show error message
					errorText.textContent = 'Network error. Please check your connection and try again.';
					errorMessage.classList.remove('hidden');
					errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
				} finally {
					// Reset button state
					submitBtn.disabled = false;
					btnText.classList.remove('hidden');
					btnLoading.classList.add('hidden');
				}
			});
		</script>
	</body>
</html>
