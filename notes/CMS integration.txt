TECHNICAL DOCUMENTATION: RCC WEBSITE CMS INTEGRATION

OVERVIEW

The RCC website is an Astro-based static site hosted on Vercel with an integrated Content Management System (CMS) for non-technical users to edit content. The system uses Decap CMS (formerly Netlify CMS) with GitHub as the content backend, allowing editors to make changes through a web interface that automatically commits to GitHub and triggers deployments.

ARCHITECTURE

The system consists of four main components:

1. Static Website (Astro)
   - Framework: Astro 5.x
   - Build output: Static HTML/CSS/JS
   - Content: Markdown files in src/content/
   - Hosting: Vercel

2. Content Management System (Decap CMS)
   - Web-based editing interface at /admin
   - Configuration: public/admin/config.yml
   - Interface: public/admin/index.html
   - No database required

3. Authentication Layer (GitHub OAuth)
   - OAuth App registered on GitHub
   - Serverless functions for OAuth flow
   - Direct GitHub API integration

4. Deployment Pipeline (Vercel)
   - Automatic builds on Git push
   - Serverless function hosting
   - Edge network distribution

TECHNOLOGY STACK

Frontend:
- Astro 5.x (Static Site Generator)
- Tailwind CSS 4.x (Styling)
- JavaScript/TypeScript

CMS:
- Decap CMS 3.x (Content Management)
- Loaded via CDN (unpkg.com)

Backend/Infrastructure:
- GitHub (Git repository and OAuth)
- Vercel (Hosting and serverless functions)
- Node.js runtime for serverless functions

Content:
- Markdown with YAML frontmatter
- Astro Content Collections API
- Git-based version control

CONTENT ARCHITECTURE

Content Collections (src/content/):

1. pages/
   - home.md (Home page content)
   - about.md (About Us page)
   - skills/ (7 skill pages as markdown files)

2. blog/
   - Individual blog post markdown files
   - Schema includes title, description, date, tags, etc.

Content Configuration (src/content.config.ts):
- Defines collections and their schemas
- Uses Astro's glob loader
- TypeScript type checking with Zod

Page Implementation:
- Pages fetch content using getEntry() or getCollection()
- Content rendered using Astro's render() function
- Dynamic routes generate pages from markdown files

AUTHENTICATION FLOW

GitHub OAuth Implementation:

1. OAuth App Setup:
   - Registered on GitHub Developer Settings
   - Client ID and Client Secret stored as Vercel environment variables
   - Callback URL: https://rcc-website-five.vercel.app/api/callback

2. Serverless Functions (api/):

   api/auth.js:
   - Initiates OAuth flow
   - Redirects to GitHub authorization URL
   - Passes client_id and callback URL
   - Requests "repo" and "user" scopes

   api/callback.js:
   - Receives authorization code from GitHub
   - Exchanges code for access token
   - Returns token to CMS via postMessage
   - Enables CMS to make GitHub API calls

3. Authentication Flow:
   Step 1: User clicks "Login with GitHub" in CMS
   Step 2: CMS calls /api/auth
   Step 3: /api/auth redirects to GitHub
   Step 4: User authorizes on GitHub
   Step 5: GitHub redirects to /api/callback with code
   Step 6: /api/callback exchanges code for token
   Step 7: Token passed back to CMS
   Step 8: CMS uses token for GitHub API calls

CONTENT EDITING WORKFLOW

1. Editor Access:
   - Editor navigates to /admin
   - Logs in via GitHub OAuth
   - CMS obtains GitHub access token

2. Content Editing:
   - CMS loads content from GitHub via API
   - Editor makes changes in web interface
   - Changes held in browser until published

3. Publishing:
   - Editor clicks "Publish"
   - CMS creates Git commit via GitHub API
   - Commit pushed directly to main branch
   - GitHub webhook triggers Vercel deployment

4. Deployment:
   - Vercel detects new commit
   - Runs: npm install && npm run build
   - Generates static site in dist/
   - Deploys to edge network
   - Process takes 2-3 minutes

5. Live Update:
   - Changes appear on production site
   - Old version cached, gradually replaced
   - Hard refresh may be needed initially

CMS CONFIGURATION

File: public/admin/config.yml

Backend Configuration:
- name: github
- repo: xl1393/RCC-website
- branch: main
- base_url: https://rcc-website-five.vercel.app
- auth_endpoint: api/auth

Collections:

1. Pages (File-based):
   - home.md: Title, subtitle, CTA buttons
   - about.md: Title, description, body

2. Skills Pages (Folder-based):
   - Location: src/content/pages/skills/
   - Cannot create/delete (create: false, delete: false)
   - Edit existing 7 skill pages only

3. Blog Posts (Folder-based):
   - Location: src/content/blog/
   - Can create, edit, delete
   - Fields: title, description, dates, images, tags, etc.

Media:
- Uploaded to: public/images/uploads/
- Referenced as: /images/uploads/filename.jpg

SERVERLESS FUNCTIONS

Deployment: api/ folder (Vercel serverless functions)

api/auth.js:
- Runtime: Node.js
- Execution: On-demand when /api/auth is called
- Purpose: OAuth initiation
- Returns: HTTP redirect to GitHub

api/callback.js:
- Runtime: Node.js
- Execution: On-demand when GitHub redirects back
- Purpose: Token exchange
- Returns: HTML with postMessage script

Environment Variables (Vercel):
- OAUTH_CLIENT_ID: GitHub OAuth app client ID
- OAUTH_CLIENT_SECRET: GitHub OAuth app secret
- Accessible in serverless functions via process.env

Function Limitations:
- 100 hours total execution per month (free tier)
- 6,000 minutes execution per month
- Each auth flow uses ~100ms
- Well within limits for typical usage

DEPLOYMENT CONFIGURATION

Vercel Settings:

Build Command:
npm run build

Output Directory:
dist

Install Command:
npm install

Framework: Astro (auto-detected)

Environment Variables:
- OAUTH_CLIENT_ID (Production, Preview, Development)
- OAUTH_CLIENT_SECRET (Production, Preview, Development)

Deployment Triggers:
- Push to main branch
- Pull request (preview deployment)
- Manual redeployment

Build Process:
1. Install dependencies (npm install)
2. Run Astro build (generates static files)
3. Deploy dist/ folder to edge network
4. Deploy api/ functions to serverless platform
5. Update DNS/routing
6. Site goes live

Deployment Limits (Free Tier):
- 100 deployments per day
- 100 GB bandwidth per month
- Sufficient for typical editorial use

GIT WORKFLOW

Repository: https://github.com/xl1393/RCC-website
Branch: main
Collaborators: Added via GitHub repository settings

Commit Flow:
1. Editor publishes in CMS
2. Decap CMS creates commit via GitHub API
3. Commit message: "Update [filename]"
4. Committed by: GitHub OAuth user
5. Pushed directly to main branch

Commit Attribution:
- Personal GitHub account: Attributed to that user
- Shared account: Attributed to rcc.cuny@gmail.com

Version Control:
- All changes tracked in Git history
- Can revert to any previous version
- View history: GitHub repository commits tab

FILE STRUCTURE

Project Root:
/
├── api/                          # Vercel serverless functions
│   ├── auth.js                   # OAuth initiation
│   └── callback.js               # OAuth callback
├── public/                       # Static assets
│   ├── admin/                    # CMS files
│   │   ├── index.html           # CMS interface
│   │   └── config.yml           # CMS configuration
│   └── images/                   # Images
├── src/
│   ├── content/                  # Content collections
│   │   ├── blog/                # Blog posts (markdown)
│   │   └── pages/               # Page content (markdown)
│   │       ├── home.md
│   │       ├── about.md
│   │       └── skills/          # Skills pages
│   ├── pages/                    # Astro page routes
│   │   ├── index.astro          # Home page (uses content)
│   │   ├── about.astro          # About page (uses content)
│   │   ├── resources.astro      # Resources (hardcoded)
│   │   └── skills/[slug].astro  # Skills pages (uses content)
│   └── content.config.ts         # Content schema definitions
├── package.json                  # Dependencies
└── astro.config.mjs             # Astro configuration

Build Output (dist/):
- Generated by Astro build
- Contains static HTML, CSS, JS
- Includes public/admin files
- Deployed to Vercel

CONTENT RENDERING

Astro Content Collections API:

Import Functions:
- getEntry(collection, id): Fetch single entry
- getCollection(collection): Fetch all entries
- render(entry): Convert markdown to HTML

Example (src/pages/about.astro):
import { getEntry, render } from 'astro:content';
const aboutPage = await getEntry('pages', 'about');
const { Content } = await render(aboutPage);
const { title, description } = aboutPage.data;

Rendering:
- Markdown parsed to HTML at build time
- Frontmatter available as typed objects
- Content component renders body
- Fully static output (no client-side rendering)

SECURITY CONSIDERATIONS

Authentication:
- GitHub OAuth provides secure authentication
- No passwords stored in application
- Access token never exposed to client
- Token scoped to repo and user only

Authorization:
- GitHub repository collaborator permissions
- Only collaborators can push commits
- CMS respects GitHub permissions

Environment Variables:
- OAuth secrets stored securely in Vercel
- Never exposed in client-side code
- Only accessible to serverless functions

API Endpoints:
- /api/* routes only callable by CMS
- OAuth callback validates state
- Token exchange happens server-side

LIMITATIONS AND CONSIDERATIONS

Current Limitations:

1. No local CMS editing:
   - CMS requires OAuth serverless functions
   - Cannot work on pure static hosting
   - Local editing requires direct file modification

2. Deployment dependency:
   - Changes require Vercel rebuild
   - 2-3 minute delay for changes to go live
   - Cannot instant-publish content

3. No media library:
   - Images uploaded per-post
   - No centralized asset management
   - Manual image optimization needed

4. Single branch workflow:
   - All changes go to main branch
   - No staging environment via CMS
   - Preview only in CMS interface

5. GitHub rate limits:
   - 5,000 API calls per hour (authenticated)
   - Unlikely to hit in normal use
   - Could affect very high-frequency editing

Future Considerations:

1. Staging Environment:
   - Could add preview branch support
   - Requires CMS configuration changes
   - Vercel supports preview deployments

2. Media Management:
   - Could implement Cloudinary or similar
   - Requires CMS plugin configuration
   - Improves image handling workflow

3. Editorial Workflow:
   - Could add draft/review process
   - Decap CMS supports editorial workflow
   - Requires additional configuration

4. Multiple Environments:
   - Dev/Staging/Prod setup possible
   - Would need branch strategy
   - Increases deployment complexity

TROUBLESHOOTING

Common Issues:

1. "Repo not found" error:
   - User not added as GitHub collaborator
   - OAuth app not authorized
   - Fix: Add user to repository

2. Login redirects to 404:
   - OAuth callback URL mismatch
   - Fix: Verify GitHub OAuth app settings

3. Changes not appearing:
   - Vercel build still in progress
   - Browser cache showing old version
   - Fix: Wait 3 minutes, hard refresh

4. Function timeout:
   - Serverless function exceeds time limit
   - Rare with OAuth flow
   - Fix: Check Vercel function logs

5. Build failures:
   - Invalid markdown syntax
   - Missing required frontmatter fields
   - Fix: Check Vercel deployment logs

Debugging:

Vercel Logs:
- View at vercel.com dashboard
- Shows build output and errors
- Serverless function execution logs

GitHub Commits:
- Verify commits appear in repository
- Check commit messages from CMS
- Confirm user attribution

CMS Console:
- Browser developer tools
- Network tab shows API calls
- Console shows CMS errors

MAINTENANCE

Regular Tasks:

1. Monitor Deployments:
   - Check Vercel dashboard weekly
   - Verify successful builds
   - Review deployment frequency

2. User Management:
   - Add/remove GitHub collaborators as needed
   - Audit shared account usage
   - Review commit history for attribution

3. Content Backup:
   - GitHub repository is backup
   - Can clone repository anytime
   - All history preserved in Git

4. Dependency Updates:
   - Update Astro periodically (npm update)
   - Check for Decap CMS updates
   - Test thoroughly before deploying

5. OAuth Token Rotation:
   - GitHub tokens don't expire (with repo scope)
   - Could implement token refresh if needed
   - Monitor for security advisories

COST ANALYSIS

Current Costs (Free Tier):

Vercel:
- $0/month (Hobby plan)
- 100 deployments/day included
- 100 GB bandwidth/month
- Sufficient for current needs

GitHub:
- $0/month (Public repository)
- Unlimited collaborators
- Unlimited commits

Decap CMS:
- $0 (Open source, self-hosted)
- Loaded via CDN

Domain:
- Hosted on Vercel subdomain (free)
- Custom domain would be separate cost

Total: $0/month for current usage

Upgrade Costs (if needed):

Vercel Pro:
- $20/month per member
- Unlimited deployments
- 1 TB bandwidth
- Team collaboration features

GitHub Team:
- $4/user/month
- Private repositories
- Advanced permissions

CONCLUSION

The RCC website CMS integration provides a Git-based content management solution that balances ease of use for editors with version control, security, and developer control. The system leverages free tier services effectively while maintaining professional-grade workflows and the ability to scale as needed.

Key Strengths:
- No database required (Git-based)
- Version control built-in
- Free hosting and CMS
- Easy editor onboarding
- Professional deployment pipeline

The architecture is maintainable, scalable, and cost-effective for the organization's needs.
